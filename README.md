# python_test
 

pip install virtualenv 

cd / корень проекта

создание вирутального окружения
virtualenv env 

активация  
env\Scripts\activate

установка в виртуальное окружение
pip install seleninum
pip install pytest

обновление chromedriver 
https://sites.google.com/a/chromium.org/chromedriver/downloads

переключение тест раннера
settings > tools > Python Integreted Tools > Default Test Runner

self параметр метода, - объект в котором этот метод вызван

команды уровня драйвера webdriver ui
find_element_by()
find_elements_by()
click()
clear()
send_keys()

text
get_attribute()
is_displayed()
location
size

В тестах надо явно задавать параметры, чтобы полностью контролировалась ситуация. А вспомагательные методы должны быть универсальными.

Вместо того, чтобы передать несколько параметров, нужно передавать объект (сгруппированные параметры).

фикстура (оснастка, фиксатор в котором "зажимаем" тестируемую систему)

В начале производится инициализация. На этом этапе создается фикстура.
Примеры фикстур:
- браузер, управляемый драйвером
- соединение с базой данных.

В pytest предполагается, что фикстура - это самостоятельный объект. Можно написать функцию, которая создает этот объект. 

@pytest.fixture
def app(request):
    fixture = Application()
    request.addfinalizer(fixture.destroy)
    return fixture

pytest непосредственно запускает тестовые функции (создания тестовых классов необязательно)

Когда pytest видит, что у тестового метода есть параметр, он пытается найти функцию, которая создает объект- фикстуру. Этот объект передается как параметр в тестовый метод.

Для разрушения фикстуры в функцию инициализации передается параметр request, у которого есть метод addfinalizer(). В него нужно передать функцию, которая вызывает разрушение.
 
драйвер инициализируется один раз, при создании фикстуры. Нужно передать эту информацию в помощник.

принцип разделения ответственности (одна сущность - одна роль)

декомпозиция

сделать функцию, которая создает общую фикстуру для всех тестов

фикстура, которая должна быть общая для всех тестов, помещается в отдельный файл conftest

для того чтобы использовать браузер для запуска всех тестов нужно указать в метке
@pytest.fixtura(scope="session")


в качестве дефолтного значение None - поле не проинициализировано

---
интелектуальная фикстура

Следует избегать дублирования кода - повторение логина и логаута в каждом тесте. Для этого нужно перенести в фикстуру функцию логина и логаута (добавить действие в finalizer).

Все тесты выполняются в одном и том же бразузере и одной и той же сессии (оптимизация по скорости).

Если во время выполнения набора тестов бразузер падает (или тест его случайно закрывает), последующие тесты упадут. 

Нужно добавить валидацию фикстуры перед каждым тестом. Затем для финализации сделать отдельную функцию, которая должна выполняться автоматически в самом конце (даже если нигде в явном виде не вызвается).

Тестам требуется автиризованная сессия, поэтому следует добавить проверку предусловий в логин и логаут.

 

